<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart JSON Formatter & Validator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 30px;
        }

        .panel {
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-header::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        textarea {
            width: 100%;
            min-height: 400px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .output-area {
            width: 100%;
            min-height: 400px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            background: #f8f9fa;
            overflow: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 30px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            min-width: 150px;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-validate {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .btn-autocorrect {
            background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
        }

        .btn-similar {
            background: linear-gradient(135deg, #4776e6 0%, #8e54e9 100%);
        }

        .btn-clear {
            background: linear-gradient(135deg, #757f9a 0%, #d7dde8 100%);
            flex: 0.5;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .message {
            margin: 20px 30px;
            padding: 15px 20px;
            border-radius: 8px;
            display: none;
        }

        .message.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.error {
            background: #fee;
            border-left: 4px solid #f44;
            color: #c33;
        }

        .message.success {
            background: #efe;
            border-left: 4px solid #4c4;
            color: #363;
        }

        .message.info {
            background: #eef;
            border-left: 4px solid #44f;
            color: #336;
        }

        .similarity-results {
            margin: 20px 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .similarity-results.show {
            display: block;
        }

        .similarity-item {
            padding: 12px;
            margin: 10px 0;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .similarity-score {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }

        .json-key {
            color: #881391;
            font-weight: bold;
        }

        .json-string {
            color: #1A1AA6;
        }

        .json-number {
            color: #164;
        }

        .json-boolean {
            color: #D73;
        }

        .json-null {
            color: #999;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }

            .controls {
                flex-direction: column;
            }

            button {
                min-width: 100%;
            }
        }

        .stats {
            margin: 20px 30px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat-card {
            flex: 1;
            min-width: 150px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .details-section {
            margin: 20px 30px;
            display: none;
        }

        .details-section.show {
            display: block;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .detail-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .detail-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .key-list {
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
        }

        .key-item {
            padding: 8px 12px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            border-left: 3px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .key-name {
            color: #333;
            font-weight: 500;
        }

        .key-count {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
        }

        .value-item {
            padding: 8px 12px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            border-left: 3px solid #ee0979;
            word-break: break-word;
        }

        .value-frequency {
            background: #ee0979;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 8px;
        }

        .common-key-badge {
            background: #38ef7d;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 8px;
        }

        .data-type-badge {
            background: #8e54e9;
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🔧 Smart JSON Formatter & Validator</h1>
            <p class="subtitle">Validate, Auto-Correct, Format, and Find Similar Values</p>
        </header>

        <div class="main-content">
            <div class="panel">
                <div class="panel-header">Input JSON</div>
                <textarea id="jsonInput" placeholder="Paste your JSON here (even malformed JSON)..."></textarea>
            </div>
            <div class="panel">
                <div class="panel-header">Formatted Output</div>
                <div id="jsonOutput" class="output-area">Your formatted JSON will appear here...</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-validate" onclick="validateJSON()">✓ Validate</button>
            <button class="btn-autocorrect" onclick="autoCorrectJSON()">🔧 Auto-Correct</button>
            <button class="btn-similar" onclick="findSimilarValues()">🔍 Find Similar Values</button>
            <button class="btn-clear" onclick="clearAll()">✕ Clear</button>
        </div>

        <div id="message" class="message"></div>

        <div id="stats" class="stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="statKeys">0</div>
                <div class="stat-label">Unique Keys</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statTotalKeys">0</div>
                <div class="stat-label">Total Keys</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statValues">0</div>
                <div class="stat-label">Total Values</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statDepth">0</div>
                <div class="stat-label">Max Depth</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statArrays">0</div>
                <div class="stat-label">Arrays</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statObjects">0</div>
                <div class="stat-label">Objects</div>
            </div>
        </div>

        <div id="detailsSection" class="details-section">
            <div class="details-grid">
                <div class="detail-card">
                    <h3>📋 All Keys Found</h3>
                    <div id="allKeysList" class="key-list"></div>
                </div>
                <div class="detail-card">
                    <h3>🔑 Common Keys (in all objects)</h3>
                    <div id="commonKeysList" class="key-list"></div>
                </div>
                <div class="detail-card">
                    <h3>🔢 Most Repeated Values</h3>
                    <div id="repeatedValuesList" class="key-list"></div>
                </div>
                <div class="detail-card">
                    <h3>📊 Data Type Distribution</h3>
                    <div id="dataTypesList" class="key-list"></div>
                </div>
            </div>
        </div>

        <div id="similarityResults" class="similarity-results"></div>
    </div>

    <script>
        /**
         * Calculate Levenshtein distance between two strings
         * Used for fuzzy string matching
         */
        function levenshteinDistance(str1, str2) {
            const m = str1.length;
            const n = str2.length;
            const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));

            for (let i = 0; i <= m; i++) dp[i][0] = i;
            for (let j = 0; j <= n; j++) dp[0][j] = j;

            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    if (str1[i - 1] === str2[j - 1]) {
                        dp[i][j] = dp[i - 1][j - 1];
                    } else {
                        dp[i][j] = Math.min(
                            dp[i - 1][j] + 1,    // deletion
                            dp[i][j - 1] + 1,    // insertion
                            dp[i - 1][j - 1] + 1 // substitution
                        );
                    }
                }
            }
            return dp[m][n];
        }

        /**
         * Calculate similarity percentage between two strings
         * Returns a value between 0 and 1
         */
        function calculateSimilarity(str1, str2) {
            const maxLen = Math.max(str1.length, str2.length);
            if (maxLen === 0) return 1.0;
            const distance = levenshteinDistance(str1, str2);
            return (1 - distance / maxLen);
        }

        /**
         * Remove invisible and problematic characters from JSON string
         */
        function cleanInvisibleChars(jsonStr) {
            return jsonStr
                // Remove zero-width spaces and other invisible Unicode characters
                .replace(/[\u200B-\u200D\uFEFF]/g, '')
                // Replace smart quotes with regular quotes
                .replace(/[\u201C\u201D]/g, '"')
                .replace(/[\u2018\u2019]/g, "'")
                // Remove null bytes and control characters (except newlines, tabs)
                .replace(/[\x00-\x08\x0B-\x0C\x0E-\x1F]/g, '')
                // Remove BOM (Byte Order Mark)
                .replace(/^\uFEFF/, '');
        }

        /**
         * Detect if input contains multiple JSON objects/arrays
         */
        function detectMultipleJSON(jsonStr) {
            const trimmed = jsonStr.trim();
            
            // Check for patterns like ][, }{, or multiple root-level structures
            if (trimmed.match(/\]\s*\[/) || trimmed.match(/\}\s*\{/) || trimmed.match(/\}\s*\[/) || trimmed.match(/\]\s*\{/)) {
                return true;
            }
            
            // Try to find multiple complete JSON structures
            let depth = 0;
            let inString = false;
            let escape = false;
            let firstComplete = -1;
            
            for (let i = 0; i < trimmed.length; i++) {
                const char = trimmed[i];
                
                if (escape) {
                    escape = false;
                    continue;
                }
                
                if (char === '\\') {
                    escape = true;
                    continue;
                }
                
                if (char === '"') {
                    inString = !inString;
                    continue;
                }
                
                if (inString) continue;
                
                if (char === '{' || char === '[') {
                    depth++;
                } else if (char === '}' || char === ']') {
                    depth--;
                    if (depth === 0 && firstComplete === -1) {
                        firstComplete = i;
                    } else if (depth === 0 && firstComplete !== -1 && i < trimmed.length - 1) {
                        // Found another complete structure after the first
                        const remaining = trimmed.slice(i + 1).trim();
                        if (remaining && (remaining[0] === '{' || remaining[0] === '[')) {
                            return true;
                        }
                    }
                }
            }
            
            return false;
        }

        /**
         * Attempt to auto-correct common JSON syntax errors
         */
        function attemptAutoCorrect(jsonStr) {
            let corrected = jsonStr;

            // Clean invisible characters first
            corrected = cleanInvisibleChars(corrected);

            // Fix escaped quotes that shouldn't be escaped (common in copied JSON)
            corrected = corrected.replace(/\\"/g, '"');

            // Check if we have multiple JSON objects/arrays that need wrapping
            if (detectMultipleJSON(corrected)) {
                const trimmed = corrected.trim();
                
                // If it looks like multiple objects, wrap in array
                if (trimmed.match(/\}\s*\{/)) {
                    // Add commas between objects
                    corrected = trimmed.replace(/\}\s*\{/g, '},{');
                    // Wrap in array if not already
                    if (!corrected.startsWith('[')) {
                        corrected = '[' + corrected + ']';
                    }
                }
                // If it looks like multiple arrays, wrap in outer array
                else if (trimmed.match(/\]\s*\[/)) {
                    corrected = trimmed.replace(/\]\s*\[/g, '],[');
                    if (!corrected.startsWith('[')) {
                        corrected = '[' + corrected + ']';
                    }
                }
                // Mixed structures
                else if (trimmed.match(/\}\s*\[/) || trimmed.match(/\]\s*\{/)) {
                    corrected = trimmed.replace(/\}\s*\[/g, '},[').replace(/\]\s*\{/g, '],{');
                    if (!corrected.startsWith('[')) {
                        corrected = '[' + corrected + ']';
                    }
                }
            }

            // Replace single quotes with double quotes (for keys and values)
            corrected = corrected.replace(/'/g, '"');

            // Remove trailing commas before closing braces/brackets
            corrected = corrected.replace(/,(\s*[}\]])/g, '$1');

            // Add missing commas between array/object elements (basic heuristic)
            // Match: }" or ]" or "} or "] patterns
            corrected = corrected.replace(/([}\]"])(\s*)([{\["])/g, '$1,$2$3');

            // Fix missing colons in key-value pairs
            corrected = corrected.replace(/"(\w+)"(\s*)([^:,}\]])/g, '"$1":$2$3');

            // Remove duplicate commas
            corrected = corrected.replace(/,+/g, ',');

            // Try to balance braces and brackets
            const openBraces = (corrected.match(/{/g) || []).length;
            const closeBraces = (corrected.match(/}/g) || []).length;
            const openBrackets = (corrected.match(/\[/g) || []).length;
            const closeBrackets = (corrected.match(/\]/g) || []).length;

            if (openBraces > closeBraces) {
                corrected += '}'.repeat(openBraces - closeBraces);
            }
            if (openBrackets > closeBrackets) {
                corrected += ']'.repeat(openBrackets - closeBrackets);
            }

            return corrected;
        }

        /**
         * Syntax highlight JSON string
         */
        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(
                /("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,
                function (match) {
                    let cls = 'json-number';
                    if (/^"/.test(match)) {
                        if (/:$/.test(match)) {
                            cls = 'json-key';
                        } else {
                            cls = 'json-string';
                        }
                    } else if (/true|false/.test(match)) {
                        cls = 'json-boolean';
                    } else if (/null/.test(match)) {
                        cls = 'json-null';
                    }
                    return '<span class="' + cls + '">' + match + '</span>';
                }
            );
        }

        /**
         * Calculate comprehensive JSON statistics
         */
        function calculateStats(obj) {
            let keyCount = 0;
            let totalKeyOccurrences = 0;
            let valueCount = 0;
            let maxDepth = 0;
            let arrayCount = 0;
            let objectCount = 0;
            const allKeys = {};
            const allValues = {};
            const dataTypes = {
                string: 0,
                number: 0,
                boolean: 0,
                null: 0,
                array: 0,
                object: 0
            };

            function traverse(o, depth = 0, parentIsArray = false) {
                maxDepth = Math.max(maxDepth, depth);
                
                if (o === null) {
                    dataTypes.null++;
                    valueCount++;
                    return;
                }
                
                const type = typeof o;
                
                if (Array.isArray(o)) {
                    arrayCount++;
                    dataTypes.array++;
                    valueCount++;
                    o.forEach(item => traverse(item, depth + 1, true));
                } else if (type === 'object') {
                    objectCount++;
                    if (!parentIsArray) dataTypes.object++;
                    
                    const keys = Object.keys(o);
                    keys.forEach(key => {
                        // Count key occurrences
                        allKeys[key] = (allKeys[key] || 0) + 1;
                        totalKeyOccurrences++;
                        
                        const value = o[key];
                        const valueType = value === null ? 'null' : Array.isArray(value) ? 'array' : typeof value;
                        
                        // Count values (for primitives)
                        if (valueType === 'string' || valueType === 'number' || valueType === 'boolean') {
                            const valueKey = String(value);
                            allValues[valueKey] = (allValues[valueKey] || 0) + 1;
                            dataTypes[valueType]++;
                            valueCount++;
                        }
                        
                        // Recursively traverse
                        if (valueType === 'object' || valueType === 'array') {
                            traverse(value, depth + 1, false);
                        }
                    });
                } else {
                    // Primitive value
                    dataTypes[type]++;
                    valueCount++;
                }
            }

            traverse(obj);
            
            keyCount = Object.keys(allKeys).length;
            
            return { 
                keyCount, 
                totalKeyOccurrences,
                valueCount, 
                maxDepth, 
                arrayCount, 
                objectCount,
                allKeys,
                allValues,
                dataTypes
            };
        }

        /**
         * Find common keys across all objects in the JSON
         */
        function findCommonKeys(obj) {
            const objectsList = [];
            
            function collectObjects(o) {
                if (typeof o === 'object' && o !== null && !Array.isArray(o)) {
                    objectsList.push(Object.keys(o));
                }
                
                if (Array.isArray(o)) {
                    o.forEach(item => collectObjects(item));
                } else if (typeof o === 'object' && o !== null) {
                    Object.values(o).forEach(value => collectObjects(value));
                }
            }
            
            collectObjects(obj);
            
            if (objectsList.length === 0) return [];
            if (objectsList.length === 1) return objectsList[0];
            
            // Find keys that appear in all objects
            const firstKeys = new Set(objectsList[0]);
            const commonKeys = [...firstKeys].filter(key => 
                objectsList.every(objKeys => objKeys.includes(key))
            );
            
            return commonKeys;
        }

        /**
         * Display detailed statistics
         */
        function displayDetailedStats(stats, commonKeys, obj) {
            // All Keys
            const allKeysHTML = Object.entries(stats.allKeys)
                .sort((a, b) => b[1] - a[1])
                .map(([key, count]) => {
                    const isCommon = commonKeys.includes(key);
                    return `
                        <div class="key-item">
                            <span class="key-name">${key}${isCommon ? '<span class="common-key-badge">COMMON</span>' : ''}</span>
                            <span class="key-count">${count}×</span>
                        </div>
                    `;
                })
                .join('');
            document.getElementById('allKeysList').innerHTML = allKeysHTML || '<p>No keys found</p>';

            // Common Keys
            if (commonKeys.length > 0) {
                const commonKeysHTML = commonKeys.map(key => `
                    <div class="key-item">
                        <span class="key-name">${key}</span>
                        <span class="key-count">${stats.allKeys[key]}×</span>
                    </div>
                `).join('');
                document.getElementById('commonKeysList').innerHTML = commonKeysHTML;
            } else {
                document.getElementById('commonKeysList').innerHTML = '<p>No keys common to all objects</p>';
            }

            // Most Repeated Values
            const repeatedValues = Object.entries(stats.allValues)
                .filter(([_, count]) => count > 1)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20); // Top 20

            if (repeatedValues.length > 0) {
                const repeatedHTML = repeatedValues.map(([value, count]) => {
                    const displayValue = value.length > 100 ? value.substring(0, 100) + '...' : value;
                    return `
                        <div class="value-item">
                            <div>
                                <code>${displayValue}</code>
                                <span class="value-frequency">${count}×</span>
                            </div>
                        </div>
                    `;
                }).join('');
                document.getElementById('repeatedValuesList').innerHTML = repeatedHTML;
            } else {
                document.getElementById('repeatedValuesList').innerHTML = '<p>No repeated values found</p>';
            }

            // Data Types
            const dataTypesHTML = Object.entries(stats.dataTypes)
                .filter(([_, count]) => count > 0)
                .sort((a, b) => b[1] - a[1])
                .map(([type, count]) => `
                    <div class="key-item">
                        <span class="key-name">${type}<span class="data-type-badge">${type.toUpperCase()}</span></span>
                        <span class="key-count">${count}</span>
                    </div>
                `)
                .join('');
            document.getElementById('dataTypesList').innerHTML = dataTypesHTML;

            // Show details section
            document.getElementById('detailsSection').classList.add('show');
        }

        /**
         * Display message to user
         */
        function showMessage(text, type = 'info') {
            const msgEl = document.getElementById('message');
            msgEl.textContent = text;
            msgEl.className = `message ${type} show`;
            setTimeout(() => {
                msgEl.classList.remove('show');
            }, 5000);
        }

        /**
         * Validate JSON
         */
        function validateJSON() {
            const input = document.getElementById('jsonInput').value.trim();
            
            if (!input) {
                showMessage('Please enter some JSON to validate.', 'error');
                return;
            }

            try {
                const parsed = JSON.parse(input);
                const formatted = JSON.stringify(parsed, null, 2);
                document.getElementById('jsonOutput').innerHTML = syntaxHighlight(formatted);
                showMessage('✓ Valid JSON! No errors found.', 'success');
                
                // Show stats
                const stats = calculateStats(parsed);
                const commonKeys = findCommonKeys(parsed);
                
                document.getElementById('stats').style.display = 'flex';
                document.getElementById('statKeys').textContent = stats.keyCount;
                document.getElementById('statTotalKeys').textContent = stats.totalKeyOccurrences;
                document.getElementById('statValues').textContent = stats.valueCount;
                document.getElementById('statDepth').textContent = stats.maxDepth;
                document.getElementById('statArrays').textContent = stats.arrayCount;
                document.getElementById('statObjects').textContent = stats.objectCount;
                
                displayDetailedStats(stats, commonKeys, parsed);
            } catch (error) {
                showMessage(`✗ Invalid JSON: ${error.message}`, 'error');
                document.getElementById('jsonOutput').textContent = 'Invalid JSON. Try Auto-Correct to fix common issues.';
                document.getElementById('detailsSection').classList.remove('show');
            }
        }

        /**
         * Auto-correct and validate JSON
         */
        function autoCorrectJSON() {
            const input = document.getElementById('jsonInput').value.trim();
            
            if (!input) {
                showMessage('Please enter some JSON to auto-correct.', 'error');
                return;
            }

            // Try parsing original first
            try {
                const parsed = JSON.parse(input);
                const formatted = JSON.stringify(parsed, null, 2);
                document.getElementById('jsonOutput').innerHTML = syntaxHighlight(formatted);
                showMessage('✓ JSON was already valid! No corrections needed.', 'success');
                
                const stats = calculateStats(parsed);
                const commonKeys = findCommonKeys(parsed);
                
                document.getElementById('stats').style.display = 'flex';
                document.getElementById('statKeys').textContent = stats.keyCount;
                document.getElementById('statTotalKeys').textContent = stats.totalKeyOccurrences;
                document.getElementById('statValues').textContent = stats.valueCount;
                document.getElementById('statDepth').textContent = stats.maxDepth;
                document.getElementById('statArrays').textContent = stats.arrayCount;
                document.getElementById('statObjects').textContent = stats.objectCount;
                
                displayDetailedStats(stats, commonKeys, parsed);
                return;
            } catch (e) {
                // Continue to auto-correction
            }

            // Attempt auto-correction
            const corrected = attemptAutoCorrect(input);
            
            try {
                const parsed = JSON.parse(corrected);
                const formatted = JSON.stringify(parsed, null, 2);
                document.getElementById('jsonOutput').innerHTML = syntaxHighlight(formatted);
                showMessage('✓ Auto-corrected successfully! Issues fixed: invalid characters, quotes, commas, braces.', 'success');
                
                const stats = calculateStats(parsed);
                const commonKeys = findCommonKeys(parsed);
                
                document.getElementById('stats').style.display = 'flex';
                document.getElementById('statKeys').textContent = stats.keyCount;
                document.getElementById('statTotalKeys').textContent = stats.totalKeyOccurrences;
                document.getElementById('statValues').textContent = stats.valueCount;
                document.getElementById('statDepth').textContent = stats.maxDepth;
                document.getElementById('statArrays').textContent = stats.arrayCount;
                document.getElementById('statObjects').textContent = stats.objectCount;
                
                displayDetailedStats(stats, commonKeys, parsed);
            } catch (error) {
                showMessage(`✗ Auto-correction failed: ${error.message}. Manual fixing required.`, 'error');
                document.getElementById('jsonOutput').textContent = `Auto-correction attempted but failed.\n\nCorrected version:\n${corrected}\n\nError: ${error.message}`;
                document.getElementById('detailsSection').classList.remove('show');
            }
        }

        /**
         * Extract all string values from JSON object recursively
         */
        function extractStringValues(obj, path = '') {
            let values = [];
            
            if (typeof obj === 'string') {
                return [{ value: obj, path }];
            }
            
            if (typeof obj === 'object' && obj !== null) {
                if (Array.isArray(obj)) {
                    obj.forEach((item, idx) => {
                        values = values.concat(extractStringValues(item, `${path}[${idx}]`));
                    });
                } else {
                    Object.keys(obj).forEach(key => {
                        const newPath = path ? `${path}.${key}` : key;
                        values = values.concat(extractStringValues(obj[key], newPath));
                    });
                }
            }
            
            return values;
        }

        /**
         * Find similar values in JSON
         */
        function findSimilarValues() {
            const input = document.getElementById('jsonInput').value.trim();
            
            if (!input) {
                showMessage('Please enter some JSON first.', 'error');
                return;
            }

            try {
                const parsed = JSON.parse(input);
                const stringValues = extractStringValues(parsed);
                
                if (stringValues.length < 2) {
                    showMessage('Need at least 2 string values to compare.', 'info');
                    return;
                }

                const similarities = [];
                const threshold = 0.80; // 80% similarity threshold

                // Compare all pairs
                for (let i = 0; i < stringValues.length; i++) {
                    for (let j = i + 1; j < stringValues.length; j++) {
                        const val1 = stringValues[i];
                        const val2 = stringValues[j];
                        
                        // Skip if values are identical
                        if (val1.value === val2.value) continue;
                        
                        // Skip very short strings (less than 3 chars)
                        if (val1.value.length < 3 || val2.value.length < 3) continue;
                        
                        const similarity = calculateSimilarity(val1.value, val2.value);
                        
                        if (similarity >= threshold) {
                            similarities.push({
                                value1: val1.value,
                                path1: val1.path,
                                value2: val2.value,
                                path2: val2.path,
                                score: similarity
                            });
                        }
                    }
                }

                // Display results
                const resultsEl = document.getElementById('similarityResults');
                
                if (similarities.length === 0) {
                    resultsEl.innerHTML = '<h3>No Similar Values Found</h3><p>No string values with ≥80% similarity were detected.</p>';
                    resultsEl.classList.add('show');
                    showMessage('No similar values found (threshold: 80%).', 'info');
                } else {
                    // Sort by similarity score (highest first)
                    similarities.sort((a, b) => b.score - a.score);
                    
                    let html = '<h3>🔍 Similar Values Detected</h3>';
                    html += `<p>Found ${similarities.length} pair(s) with ≥80% similarity:</p>`;
                    
                    similarities.forEach((sim, idx) => {
                        const scorePercent = (sim.score * 100).toFixed(1);
                        html += `
                            <div class="similarity-item">
                                <span class="similarity-score">${scorePercent}%</span>
                                <strong>Pair ${idx + 1}</strong><br>
                                <code>${sim.path1}</code>: "${sim.value1}"<br>
                                <code>${sim.path2}</code>: "${sim.value2}"
                            </div>
                        `;
                    });
                    
                    resultsEl.innerHTML = html;
                    resultsEl.classList.add('show');
                    showMessage(`✓ Found ${similarities.length} similar value pair(s)!`, 'success');
                }
            } catch (error) {
                showMessage(`Error: ${error.message}. Please validate/correct JSON first.`, 'error');
            }
        }

        /**
         * Clear all inputs and outputs
         */
        function clearAll() {
            document.getElementById('jsonInput').value = '';
            document.getElementById('jsonOutput').textContent = 'Your formatted JSON will appear here...';
            document.getElementById('message').classList.remove('show');
            document.getElementById('similarityResults').classList.remove('show');
            document.getElementById('stats').style.display = 'none';
            document.getElementById('detailsSection').classList.remove('show');
        }

        // Load example on page load (optional)
        window.addEventListener('DOMContentLoaded', function() {
            // You can uncomment this to auto-load an example
            // document.getElementById('jsonInput').value = `{"name": "John"} {"name": "Jane"}`;
        });
    </script>
</body>
</html>